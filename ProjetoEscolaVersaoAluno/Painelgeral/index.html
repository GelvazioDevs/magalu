<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Gestor</title>
  <link rel="stylesheet" href="usuarios.css">
  <link rel="stylesheet" href="index.css">
  <style>
    @keyframes girar-icone {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes transicaoAzul {
      0% { width: 0; opacity: 1; }
      50% { width: 100%; opacity: 1; }
      51% { width: 100%; opacity: 0; }
      100% { width: 0; opacity: 0; }
    }
    #linha-transicao-azul {
      position: absolute;
      width: 100%;
      height: 4px;
      background: linear-gradient(to right, transparent, #0033cc, transparent);
      bottom: 0;
      left: 0;
      pointer-events: none;
      opacity: 0;
    }
    .linha-transicao-animar {
      animation: transicaoAzul 0.7s ease-out forwards;
    }
  </style>
</head>
<body>
  <div class="light-bg-anim"></div>
  <div class="luz-linha"></div>
  <!-- Ícone voador -->
  <img id="icone-voador" src="../Imagens/Icone.png" alt="Ícone Voador" style="position:fixed; left:40vw; top:40vh; width:64px; height:64px; z-index:10; pointer-events:none; user-select:none; transition:filter 0.2s; filter: drop-shadow(0 0 12px #0033cc88); animation: girar-icone 2.5s linear infinite;">
  <div class="layout">
    <div id="sidebar"></div>
    <div class="content" id="dashboard-content">
      <div id="escola-flash-bg">
        <img id="escola-flash-img" src="../Imagens/Escola(1).png" class="painel-escola-bg" alt="Escola">
        <div id="linha-transicao-azul"></div>
      </div>
      <div class="painel-conteudo">
        <h1>Painel do Gestor</h1>
        <p>Bem-vindo! Selecione uma opção no menu.</p>
      </div>
    </div>
  </div>
  <script src="../Scripts/md5.js"></script>
  <script>
    fetch('sidebar.html').then(res => res.text()).then(data => {
      document.getElementById('sidebar').innerHTML = data;
      const usuario = JSON.parse(localStorage.getItem('usuarioLogado')) || { nome: 'Convidado', cargo: 'Convidado', email: '' };
      document.getElementById('sidebarUsuarioNome').textContent = usuario.nome || 'Convidado';
      document.getElementById('sidebarUsuarioCargo').textContent = usuario.cargo || 'Convidado';
      const avatar = document.getElementById('sidebarUsuarioAvatar');
      if (usuario.email) {
        const hash = md5(usuario.email.trim().toLowerCase());
        avatar.src = `https://www.gravatar.com/avatar/${hash}?d=identicon&s=80`;
      } else {
        avatar.src = '../Imagens/Usuario.png';
      }
      avatar.alt = usuario.nome || 'Convidado';
    });
    // Troca de imagens com linha azul de transição
    const imagens = [
      '../Imagens/Escola(1).png',
      '../Imagens/Escola(2).png',
      '../Imagens/Escola(3).png',
      '../Imagens/Escola(4).png',
      '../Imagens/Escola(5).png',
      '../Imagens/Escola(6).png',
      '../Imagens/Escola(7).png'
    ];
    let idx = 0;
    const imgEl = document.getElementById('escola-flash-img');
    const linhaTransicao = document.getElementById('linha-transicao-azul');
    function trocarImagemComLinha() {
      linhaTransicao.classList.remove('linha-transicao-animar');
      void linhaTransicao.offsetWidth; // força reflow
      linhaTransicao.classList.add('linha-transicao-animar');
      linhaTransicao.addEventListener('animationend', function handler() {
        idx = (idx + 1) % imagens.length;
        imgEl.src = imagens[idx];
        linhaTransicao.classList.remove('linha-transicao-animar');
        linhaTransicao.removeEventListener('animationend', handler);
      });
    }
    setInterval(trocarImagemComLinha, 3500);
    // Ícone voador animado
    (function() {
      const icone = document.getElementById('icone-voador');
      let x = window.innerWidth * 0.4;
      let y = window.innerHeight * 0.4;
      let dx = 2 + Math.random() * 2; // velocidade X
      let dy = 2 + Math.random() * 2; // velocidade Y
      // Direção inicial aleatória
      if (Math.random() > 0.5) dx *= -1;
      if (Math.random() > 0.5) dy *= -1;
      function moverIcone() {
        x += dx;
        y += dy;
        // Limites da tela
        const largura = window.innerWidth;
        const altura = window.innerHeight;
        const tamanho = 64;
        if (x <= 0) { x = 0; dx *= -1; }
        if (x + tamanho >= largura) { x = largura - tamanho; dx *= -1; }
        if (y <= 0) { y = 0; dy *= -1; }
        if (y + tamanho >= altura) { y = altura - tamanho; dy *= -1; }
        icone.style.left = x + 'px';
        icone.style.top = y + 'px';
        requestAnimationFrame(moverIcone);
      }
      moverIcone();
      // Responsivo ao redimensionar
      window.addEventListener('resize', () => {
        x = Math.min(x, window.innerWidth - 64);
        y = Math.min(y, window.innerHeight - 64);
      });
    })();
  </script>
</body>
</html>